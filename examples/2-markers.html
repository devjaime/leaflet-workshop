<!DOCTYPE html>

<head>

  <meta charset="utf-8">

  <title>Marker from GeoJSON</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin=""/>

  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>

  <style type="text/css">
    html, body {
      margin: 0;
      height: 100%;
    }

    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

  <div id="map"></div>

  <script>

    getJson('./defibrillators.geojson', drawMap);

    function drawMap(geojson) {

      var map = L.map('map').setView([48.13, 11.57], 11);

      var icon = new L.Icon({
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor:  [0, -18],
        iconUrl: './defibrillator.png'
      });

      L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'
      }).addTo(map);

      L.geoJson(geojson, {
        pointToLayer: function(feature, latlng) {
          return L.marker(latlng, {
            icon: icon
          });
        },
        onEachFeature: onEachFeature
      }).addTo(map);

      function onEachFeature(feature, layer) {
        layer.bindPopup(feature.properties['@id']);
      }
    }

    function getJson(path, callback) {
      var httpRequest = new XMLHttpRequest();

      httpRequest.overrideMimeType('application/json');
      httpRequest.onreadystatechange = function() {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            if (callback) callback(JSON.parse(httpRequest.responseText));
          }
        }
      };

      httpRequest.open('GET', path);
      httpRequest.send();
    }
  </script>
</body>





